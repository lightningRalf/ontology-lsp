# Ontology-LSP Unified System - Command Center
# This is the new Justfile for the unified core + adapters architecture

# Default: Show available commands
default:
    @just --list

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# SETUP & INITIALIZATION
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Initialize the unified system (run this first!)
init:
    @echo "üöÄ Initializing Ontology-LSP Unified System..."
    @echo "üìÅ Creating directory structure..."
    @mkdir -p core/{analyzer,layers,services,types}
    @mkdir -p adapters/{mcp,lsp,http,shared}
    @mkdir -p config
    @mkdir -p test/{unit,integration,e2e}
    @mkdir -p scripts
    @mkdir -p .ontology/{cache,db,logs}
    @echo "üì¶ Installing dependencies..."
    bun install
    @echo "üóÑÔ∏è Initializing database..."
    @just init-db
    @echo "‚úÖ Initialization complete!"

# Initialize database
init-db:
    @echo "üóÑÔ∏è Setting up database..."
    @mkdir -p .ontology/db
    @touch .ontology/db/ontology.db
    @echo "‚úÖ Database initialized"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# DEVELOPMENT
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Start development mode with hot-reload
dev:
    @echo "üöÄ Starting unified system in development mode..."
    @echo "üß† Core: Starting..."
    @echo "üîå Adapters: MCP (7001), HTTP (7000), LSP (7002)"
    bun run --watch core/server.ts

# Start only the MCP adapter (for MCP clients)
dev-mcp:
    @echo "ü§ñ Starting MCP adapter for MCP clients..."
    bun run --watch adapters/mcp/index.ts

# Start only the HTTP adapter (for CLI/Web)
dev-http:
    @echo "üåê Starting HTTP adapter..."
    bun run --watch adapters/http/index.ts

# Start only the LSP adapter (for VS Code)
dev-lsp:
    @echo "üìù Starting LSP adapter..."
    bun run --watch adapters/lsp/index.ts

# Start with verbose logging
dev-verbose:
    @echo "üîç Starting with verbose logging..."
    LOG_LEVEL=debug just dev

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# BUILDING
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Build the unified system
build:
    @echo "üî® Building unified system..."
    @echo "üì¶ Building core..."
    bun build core/analyzer.ts --outdir=dist/core --target=bun
    @echo "üì¶ Building MCP adapter..."
    bun build adapters/mcp/index.ts --outdir=dist/adapters/mcp --target=bun
    @echo "üì¶ Building HTTP adapter..."
    bun build adapters/http/index.ts --outdir=dist/adapters/http --target=bun
    @echo "üì¶ Building LSP adapter..."
    bun build adapters/lsp/index.ts --outdir=dist/adapters/lsp --target=bun
    @echo "‚úÖ Build complete!"

# Build for production
build-prod:
    @echo "üöÄ Building for production..."
    @just build
    @echo "üóúÔ∏è Minifying..."
    bun build dist/core/analyzer.js --minify --outfile=dist/core/analyzer.min.js
    @echo "üìä Build stats:"
    @ls -lh dist/core/*.js dist/adapters/*/*.js

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# TESTING
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Run all tests
test:
    @echo "üß™ Running all tests..."
    bun test

# Run unit tests only
test-unit:
    @echo "üß™ Running unit tests..."
    bun test tests/unit

# Run integration tests
test-integration:
    @echo "üîó Running integration tests..."
    bun test tests/integration

# Run end-to-end tests
test-e2e:
    @echo "üéØ Running end-to-end tests..."
    @just start-test-servers
    bun test tests/e2e
    @just stop-test-servers

# Run MCP adapter tests
test-mcp:
    @echo "ü§ñ Testing MCP adapter..."
    bun test tests/adapters/mcp

# Test with coverage
test-coverage:
    @echo "üìä Running tests with coverage..."
    bun test --coverage

# Run benchmarks
bench:
    @echo "‚ö° Running performance benchmarks..."
    bun run scripts/benchmark.ts

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# MIGRATION FROM OLD SYSTEM
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Migrate from duplicate implementations to unified core
migrate:
    @echo "üîÑ Starting migration to unified system..."
    @echo "üì¶ Backing up existing data..."
    @just backup
    @echo "üöö Moving best implementations to core..."
    @just extract-core
    @echo "üîß Updating imports..."
    @just update-imports
    @echo "üß™ Running migration tests..."
    @just test-migration
    @echo "‚úÖ Migration complete!"

# Extract best implementations to core
extract-core:
    @echo "üì§ Extracting best implementations..."
    # Take working implementations from src/
    @cp -r src/layers/* core/layers/ 2>/dev/null || true
    @cp -r src/ontology/* core/services/ 2>/dev/null || true
    # Remove duplicates from mcp-ontology-server/
    @echo "üóëÔ∏è Removing duplicate implementations..."
    @rm -rf mcp-ontology-server/src/layers
    @echo "‚úÖ Core extracted"

# Update imports to use unified core
update-imports:
    @echo "üîß Updating import statements..."
    bun run scripts/update-imports.ts

# Backup before migration
backup:
    @echo "üíæ Creating backup..."
    @mkdir -p .backups/$(date +%Y%m%d_%H%M%S)
    @cp -r .ontology .backups/$(date +%Y%m%d_%H%M%S)/
    @cp -r src .backups/$(date +%Y%m%d_%H%M%S)/
    @cp -r mcp-ontology-server .backups/$(date +%Y%m%d_%H%M%S)/
    @echo "‚úÖ Backup created"

# Test migration success
test-migration:
    @echo "üß™ Testing migration..."
    @echo "Testing core functionality..."
    bun test tests/migration/core.test.ts
    @echo "Testing adapter connections..."
    bun test tests/migration/adapters.test.ts
    @echo "‚úÖ Migration tests passed"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# RUNNING & DEPLOYMENT
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Start production servers
start:
    @echo "üöÄ Starting production servers..."
    @just start-core &
    @just start-mcp &
    @just start-http &
    @just start-lsp &
    @echo "‚úÖ All servers running"
    @echo "üìç MCP: localhost:7001 (MCP)"
    @echo "üìç HTTP: localhost:7000 (API/CLI)"
    @echo "üìç LSP: localhost:7002 (VS Code)"

# Start core analyzer
start-core:
    @echo "üß† Starting core analyzer..."
    bun run dist/core/analyzer.js

# Start MCP adapter
start-mcp:
    @echo "ü§ñ Starting MCP adapter on port 7001..."
    MCP_PORT=7001 bun run dist/adapters/mcp/index.js

# Start HTTP adapter
start-http:
    @echo "üåê Starting HTTP adapter on port 7000..."
    HTTP_PORT=7000 bun run dist/adapters/http/index.js

# Start LSP adapter
start-lsp:
    @echo "üìù Starting LSP adapter on port 7002..."
    LSP_PORT=7002 bun run dist/adapters/lsp/index.js

# Stop all servers
stop:
    @echo "üõë Stopping all servers..."
    @pkill -f "bun.*analyzer" || true
    @pkill -f "bun.*adapters" || true
    @echo "‚úÖ All servers stopped"

# Restart all servers
restart:
    @just stop
    @sleep 1
    @just start

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# CLAUDE CODE INTEGRATION
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Configure Claude Desktop for MCP
configure-claude:
    @echo "ü§ñ Configuring Claude Desktop..."
    @mkdir -p ~/.config/claude
    @echo "üìù Creating MCP configuration..."
    @cat > ~/.config/claude/mcp.json << 'EOF'
    {
      "mcpServers": {
        "ontology-lsp": {
          "command": "bun",
          "args": ["run", "$(pwd)/dist/adapters/mcp/index.js"],
          "env": {
            "MCP_PORT": "7001",
            "LOG_LEVEL": "info"
          }
        }
      }
    }
    EOF
    @echo "‚úÖ Claude Desktop configured!"
    @echo "üîÑ Please restart Claude Desktop to apply changes"

# Test MCP connection
test-mcp-connection:
    @echo "üß™ Testing MCP connection..."
    @echo "Starting test MCP server..."
    @just start-mcp &
    @sleep 2
    @echo "Sending test request..."
    @curl -X POST http://localhost:7001/mcp/tools/list || echo "‚ùå Connection failed"
    @echo "‚úÖ Test complete"
    @just stop

# List available MCP tools
list-mcp-tools:
    @echo "üìã Available MCP tools:"
    @curl -s http://localhost:7001/mcp/tools | jq '.tools[].name' || echo "Start server first: just start-mcp"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# MONITORING & DEBUGGING
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Show system status
status:
    @echo "üìä System Status"
    @echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    @echo "üß† Core: $(pgrep -f 'analyzer' > /dev/null && echo '‚úÖ Running' || echo '‚ùå Stopped')"
    @echo "ü§ñ MCP:  $(curl -s http://localhost:7001/health > /dev/null 2>&1 && echo '‚úÖ Running' || echo '‚ùå Stopped')"
    @echo "üåê HTTP: $(curl -s http://localhost:7000/health > /dev/null 2>&1 && echo '‚úÖ Running' || echo '‚ùå Stopped')"
    @echo "üìù LSP:  $(pgrep -f 'lsp' > /dev/null && echo '‚úÖ Running' || echo '‚ùå Stopped')"

# Health check all services
health:
    @echo "üè• Health Check"
    @echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    @curl -s http://localhost:7000/health | jq '.' || echo "HTTP: Not responding"
    @curl -s http://localhost:7001/health | jq '.' || echo "MCP: Not responding"
    @echo "‚úÖ Health check complete"

# View logs
logs:
    @echo "üìú Viewing logs..."
    @tail -f .ontology/logs/*.log

# View MCP logs
logs-mcp:
    @tail -f .ontology/logs/mcp.log

# View core logs
logs-core:
    @tail -f .ontology/logs/core.log

# Clear logs
clear-logs:
    @echo "üóëÔ∏è Clearing logs..."
    @rm -f .ontology/logs/*.log
    @echo "‚úÖ Logs cleared"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# ANALYSIS & LEARNING
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Analyze codebase for patterns
analyze:
    @echo "üß† Analyzing codebase..."
    bun run scripts/analyze.ts .

# Learn from recent changes
learn:
    @echo "üìö Learning from recent changes..."
    bun run scripts/learn.ts --from=git

# Export knowledge base
export-knowledge:
    @echo "üì¶ Exporting knowledge..."
    bun run scripts/export.ts --output=.ontology/export.json

# Import knowledge base
import-knowledge path:
    @echo "üì• Importing knowledge from {{path}}..."
    bun run scripts/import.ts {{path}}

# Show statistics
stats:
    @echo "üìä System Statistics"
    @echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    @echo "Concepts: $(sqlite3 .ontology/db/ontology.db 'SELECT COUNT(*) FROM concepts' 2>/dev/null || echo '0')"
    @echo "Patterns: $(sqlite3 .ontology/db/ontology.db 'SELECT COUNT(*) FROM patterns' 2>/dev/null || echo '0')"
    @echo "Cache entries: $(ls .ontology/cache 2>/dev/null | wc -l || echo '0')"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# MAINTENANCE
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Clean build artifacts
clean:
    @echo "üßπ Cleaning build artifacts..."
    @rm -rf dist/
    @rm -rf node_modules/
    @rm -rf .turbo/
    @echo "‚úÖ Clean complete"

# Clean everything (including cache and logs)
clean-all:
    @echo "üßπ Cleaning everything..."
    @just clean
    @rm -rf .ontology/cache/*
    @rm -rf .ontology/logs/*
    @echo "‚úÖ Full clean complete"

# Reset database (CAUTION!)
reset-db:
    @echo "‚ö†Ô∏è  This will delete all learned patterns and concepts!"
    @read -p "Are you sure? (y/N) " -n 1 -r && echo && \
    if [[ $$REPLY =~ ^[Yy]$$ ]]; then \
        rm -f .ontology/db/ontology.db; \
        just init-db; \
        echo "‚úÖ Database reset"; \
    else \
        echo "‚ùå Cancelled"; \
    fi

# Update dependencies
update-deps:
    @echo "üì¶ Updating dependencies..."
    bun update

# Format code
format:
    @echo "üé® Formatting code..."
    bunx biome format --write .

# Lint code
lint:
    @echo "üîç Linting code..."
    bunx biome check .

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# DOCKER & DEPLOYMENT
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Build Docker image
docker-build:
    @echo "üê≥ Building Docker image..."
    docker build -t ontology-lsp:latest .

# Run in Docker
docker-run:
    @echo "üê≥ Running in Docker..."
    docker run -p 7000:7000 -p 7001:7001 -p 7002:7002 \
        -v ~/.ontology:/data \
        ontology-lsp:latest

# Deploy to production
deploy env="production":
    @echo "üöÄ Deploying to {{env}}..."
    @just build-prod
    @just docker-build
    @echo "üì§ Pushing to registry..."
    docker tag ontology-lsp:latest registry.example.com/ontology-lsp:latest
    docker push registry.example.com/ontology-lsp:latest
    @echo "‚úÖ Deployment complete"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# UTILITIES
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

# Show current version
version:
    @echo "Ontology-LSP Unified System"
    @echo "Version: $(cat package.json | jq -r '.version')"
    @echo "Core: $(cat core/package.json | jq -r '.version' 2>/dev/null || echo 'dev')"
    @echo "MCP Adapter: $(cat adapters/mcp/package.json | jq -r '.version' 2>/dev/null || echo 'dev')"

# Open documentation
docs:
    @echo "üìö Opening documentation..."
    @open http://localhost:3000/docs || echo "Run 'just serve-docs' first"

# Serve documentation
serve-docs:
    @echo "üìö Serving documentation..."
    bunx vitepress dev docs

# Run interactive shell
shell:
    @echo "üêö Starting interactive shell..."
    bun repl

# Quick test of core functionality
quick-test:
    @echo "‚ö° Quick functionality test..."
    @echo "Testing find definition..."
    @curl -X POST http://localhost:7000/api/find-definition \
        -H "Content-Type: application/json" \
        -d '{"symbol": "TestClass"}' | jq '.'

# Show help
help:
    @echo "Ontology-LSP Unified System - Command Reference"
    @echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
    @echo ""
    @echo "Quick Start:"
    @echo "  just init         - Initialize the system (run first!)"
    @echo "  just dev          - Start development mode"
    @echo "  just dev-mcp      - Start MCP adapter only (for Claude)"
    @echo "  just test         - Run all tests"
    @echo ""
    @echo "Migration:"
    @echo "  just migrate      - Migrate from old duplicate system"
    @echo "  just backup       - Backup before migration"
    @echo ""
    @echo "Production:"
    @echo "  just build        - Build for production"
    @echo "  just start        - Start all servers"
    @echo "  just stop         - Stop all servers"
    @echo ""
    @echo "Claude Integration:"
    @echo "  just configure-claude - Setup Claude Desktop"
    @echo "  just test-mcp-connection - Test MCP connection"
    @echo ""
    @echo "Monitoring:"
    @echo "  just status       - Show system status"
    @echo "  just health       - Health check all services"
    @echo "  just logs         - View logs"
    @echo ""
    @echo "Run 'just --list' for all commands"

# Default environment check
check-env:
    @echo "üîç Checking environment..."
    @command -v bun >/dev/null 2>&1 || { echo "‚ùå Bun not installed"; exit 1; }
    @echo "‚úÖ Bun: $(bun --version)"
    @command -v sqlite3 >/dev/null 2>&1 || echo "‚ö†Ô∏è  SQLite3 not found (optional)"
    @command -v jq >/dev/null 2>&1 || echo "‚ö†Ô∏è  jq not found (optional)"
    @echo "‚úÖ Environment ready"
